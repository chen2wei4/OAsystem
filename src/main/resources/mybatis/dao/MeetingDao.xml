<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 会议管理 -->
<mapper namespace="com.woniuxy.oasystem.dao.MeetingDao">
	<!-- 分页查询 -->
	<select id="findAllByPage" resultMap="meetingMap">
		select m.meeting_id,m.emp_id,principal,recorder,topic,boardroom_id,start_time,end_time,file,
		p.participant_id,p.meeting_id,p.meeting_id,p.emp_id pemp_id
		from meeting m,participant p where m.meeting_id=p.meeting_id and m.flag = 1 and p.flag = 1
		<include refid="conditionSql"/>
		limit #{pageIndex},#{pageSize}
	</select>
	
	<resultMap type="Meeting" id="meetingMap">
		<id column="meeting_id" property="meetingId"/>
		<result column="emp_id" property="empId"/>
		<result column="principal" property="principal"/>
		<result column="recorder" property="recorder"/>
		<result column="topic" property="topic"/>
		<result column="boardroom_id" property="boardroomId"/>
		<result column="start_time" property="startTime"/>
		<result column="end_time" property="endTime"/>
		<result column="file" property="file"/>
		
		<collection property="participant" ofType="Participant">
			<id column="participant_id" property="participantId"/>
			<result column="pemp_id" property="empId"/>
			<result column="meeting_id" property="meetingId"/>
		</collection>
	</resultMap>
	
	<!-- 总条数-->
	<select id="findAllByPageCount" resultType="int">
		select count(*) from meeting 
		where flag = 1
		<include refid="conditionSql"/>
	</select>
	<!-- 模糊查询条件 -->
	<sql id="conditionSql">
			<if test="m.empId!= null and m.empId!=''">
				and emp_id like '%' #{m.empId} '%'
			</if>
			<if test="m.principal!= null and m.principal!=''">
				and principal like '%' #{m.principal} '%'
			</if>
			<if test="m.recorder!= null and m.recorder!=''">
				and recorder like '%' #{m.recorder} '%'
			</if>
			<if test="m.topic!= null and m.topic!=''">
				and topic like '%' #{m.topic} '%'
			</if>
			<if test="m.boardroomId!= null and m.boardroomId!=''">
				and boardroom_id like '%' #{m.boardroomId} '%'
			</if>
			<if test="m.startTime!= null and m.startTime!=''">
				and start_time like '%' #{m.startTime} '%'
			</if>
			<if test="m.endTime!= null and m.endTime!=''">
				and end_time like '%' #{m.endTime} '%'
			</if>
			
	</sql>
	<!-- 根据mid删除 -->
	<update id="deleteByMid">
		update meeting set flag = 0 where meeting_id = #{meetingId}
	</update>
	<!-- 根据mid修改 -->
	<update id="updateByMid">
		update meeting set 
		emp_id=#{m.empId},principal=#{m.principal},recorder=#{m.recorder},topic=#{m.topic},boardroom_id=#{m.boardroomId},
		start_time=#{m.startTime},end_time=#{m.endTime},file=#{m.file}
		where meeting_id = #{m.meetingId}
	</update>
	<!-- 添加 -->
	<insert id="insert">
		insert into meeting (emp_id,principal,recorder,topic,boardroom_id,start_time,end_time,file) 
		values (#{m.empId},#{m.principal},#{m.recorder},#{m.topic},#{m.boardroomId},#{m.startTime},#{m.endTime},#{m.file})
	</insert>
</mapper>